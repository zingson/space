# 注册中心


注册服务管理

配置文件维护


使用ws协议注册服务、剔除服务。达到实时的目的


使用队列实现服务间通信，不需要注册中心。

发布消息 ---> 服务订阅消息    针对消息ID发送消息  ---->  发送者订阅消息的消息  完成。

## 方式一：使用ws消息服务实现服务通讯，无需注册中心 （弃用）
1. 每个服务连接ws服务，ws服务维持连接集合
2. 


## 方式二：注册中心业务流程

1. 通讯方式：Websocket，连接注册，断开剔除；
2. 数据存储在内存中，集群使用转发请求的方式实现数据同步；
3. 存储数据结构：`{name:{instant:{host,port,instant,Time},instant:{host,port,instant,Time}}}` 
4. 服务根据服务名，订阅服务信息
5. 服务分流权重：随机方式

k=name v=[instantid]
k=instantid v={}

服务注册操作： 注册、剔除、订阅
注册中心操作： 订阅同步消息、广播操作

连接操作：注册数据存储，每次连接进行注册
```json
{
  "dc-dev": {
    "name": [
      {"sid": "","host": "","port": "","lastUpdateTime": "","weight":""},
      { },
      { }
    ]
  },
  "dc-prd": {
    "name": [
      {"sid": "","host": "","port": "","lastUpdateTime": "","weight": ""},
      { },
      { }
    ]
  }
}
```
断开操作：记录断开服务名与sid，加入队列，由单独线程进行清理操作    
```json
{
  "dc-dev": { "name": ["sid23423423423"] }
}
```
订阅操作：记录指定服务，被哪些服务订阅，当有更新时，对订阅服务进行推送
```json
{
  "dc-dev": {
    "name":["name1","name1"]  
  }
}
```

## 方式三：使用mongodb作为注册中心   （弃用）

客户端使用方式：
1. 连接mongodb，注册自身实例
2. 根据服务名，获取服务信息
3. 订阅集合指定服务的更新与插入













