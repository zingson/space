# 积分账户(points)

积分账户编号，一般对应会员系统中的用户ID，使用此积分服务，需要在会员服务建立一个与积分账户对应的记录。

仅限积分操作相关业务逻辑。

交易类型：充值、消费、过期、作废、冲正

查询操作：
 
- 查询剩余积分，条件：账户编号  
- 查询交易记录, 条件：账户编号，根据时间排序  


更新操作：

- 充值交易，账户编号、积分数、备注信息   记录流水，修改剩余积分、过期时间   
- 消费交易，账户编号、积分数、业务系统标识、业务订单号、备注信息   记录流水，修改剩余积分  
- 退回交易，账户编号、积分数、业务系统标识、业务订单号、备注信息   记录流水，修改剩余积分  
- 过期交易，账户编号、积分数、备注信息   记录流水，修改剩余积分  
- 作废交易，账户编号、积分数、备注信息   记录流水，修改剩余积分  
- 冲正交易，账户编号、积分数、需要冲正的交易流水号 ，会验证流水记录的积分数与当前请求的积分数  

- 创建账户，账户备注 ，响应账户编号  

积分过期机制

## 业务逻辑

机构积分账号，不过期
会员积分账号，设置过期，会员属于某个机构
会员与机构拥有的积分账户都在同一个积分服务

## 数据结构

积分账户集合(ms_points_account)
账户编号5位数字、发行账户编号、创建时间、状态（1=正常 2=禁用 9=注销）、积分有效期天数（天）、剩余积分、授信透支积分数、账户备注

积分可用集合ms_points_usable
记录ID_id、账户编号、充值时间、过期时间、本次充值积分数、剩余积分、预充值积分数、预扣积分数、批次号

积分交易记录(ms_points_trade)
交易流水_id、账户编号、发行账户编号（充值与回收才有值）、交易积分数、剩余积分数、交易类型、交易时间、交易备注、业务系统标识名、交易业务系统订单号、积分可用记录ID、批次号（批量充值操作标记）

积分批次号集合(ms_points_batch)
批次号、开始时间、完成时间、操作描述（如：批量赠送积分）、状态（0=创建批次 1=执行中 2=完成 =3失败）、结果简述、下载操作结果明细表格

账户操作记录(ms_points_log)
操作流水_id、操作类型、操作备注、交易流水、账户编号、操作人、操作时间

## 接口定义

- 创建积分账户（<参数：默认积分有效期天数、授信透支积分数、账户备注信息、发行方积分账户编号>    <响应：账户编号、账户默认有效期天数、账户剩余积分>  ）
- 更新积分账户（<参数：账号编号、默认积分有效期天数、授信透支积分数、账户备注信息>    <响应：账户编号、账户默认有效期天数、账户剩余积分>  ）
- 禁用积分账户（<参数：账号编号>    <响应：账户编号、状态>  ）
- 启用积分账户（<参数：账号编号>    <响应：账户编号、状态>  ）
- 注销积分账户（<参数：账号编号>    <响应：账户编号、状态>  ）
- 查询积分账户（<参数：账号编号>    <响应：账户编号、状态、创建时间、积分默认有效期、剩余积分、授信透支额度、账户备注、积分交易记录（流水号、交易积分数、剩余积分数、交易类型、交易时间、交易备注、业务名、业务订单号）>  ）
- 查询积分流水（<参数：账号编号>    <响应：>  ）
- 账户积分充值（<参数：账户编号、积分数、备注信息、过期时间   记录流水，修改剩余积分   >    <响应：>  ）
- 账户积分消费（<参数：账户编号、积分数、备注信息、过期时间   记录流水，修改剩余积分   >    <响应：>  ）
- 账户积分退回（<参数：账户编号、积分数、备注信息、过期时间   记录流水，修改剩余积分   >    <响应：>  ）
- 账户积分过期（<参数：账户编号、积分数、备注信息、过期时间   记录流水，修改剩余积分   >    <响应：>  ）
- 账户积分回收（<参数：账户编号、积分数、备注信息、过期时间   记录流水，修改剩余积分   >    <响应：>  ）
- 账户积分冲正（<参数：账户编号、积分数、备注信息、过期时间   记录流水，修改剩余积分   >    <响应：>  ）
- 账户积分预充值（用于大批量导入的情况，分批进行充值）
- 账户预充值提交

